#!/usr/local/bin/python3

import sys
import os
import subprocess
import termcolor

def main():

    command = ['/usr/local/bin/http-server']
    if (len(sys.argv) == 1):
        host = '0.0.0.0'
        port = '8080'
        command.extend([f'-a={host}', '-c-1', '--cors', '-i false', f'-p={port}', '--no-dotfiles'])
    else:
        command.extend(sys.argv[1:])
    
    codespace_name = os.getenv('CODESPACE_NAME')
    if (codespace_name is not None):
        msg = f"\nhttp-server running on https://{codespace_name}-{port}.githubpreview.dev\n"
        print(termcolor.colored(msg, 'green'))
    
    # Kill any process listing on the specified port
    os.system(f'fuser -k {port}/tcp')
    
    # Start http-server
    subprocess.run(command)


if __name__ == '__main__':
    main()